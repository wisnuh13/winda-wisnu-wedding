<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winda & Wisnu</title>
    <link rel="icon" type="image/png" href="img/logo.jpeg">
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sacramento&family=Tangerine:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <img src="img/screen.gif" alt="Loading" class="loading-gif">
        </div>
    </div>

    <!-- Background Music -->
    <audio id="background-music" loop>
        <source src="music/Sal Priadi - Semua lagu cinta (Official Music Video).mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div class="container" id="scrollContainer">

        <section id="slide1">
            <div class="reveal-text d-1">
                <p class="wedding-title">THE WEDDING OF</p>
            </div>
            <h1 class="reveal-scale d-2"><br>Winda<br>&<br> Wisnu</h1>
            <p class="to-text reveal-text d-5">Kepada Yth.<br>Bapak/Ibu/Saudara/i</p>
            <h2 id="guest-name" class="reveal-scale d-3">Tamu Undangan</h2>
            <div class="reveal-box d-4">
                <a href="#slide2" class="btn-buka"><i class="fas fa-envelope"></i> Buka Undangan</a>
            </div>
        </section>

        <section id="slide2" class="content-slide hidden-slide">
            <div class="clouds">
                <div class="cloud c1"></div>
                <div class="cloud c2"></div>
                <div class="cloud c3"></div>
            </div>
            <div class="couple-wrapper">
                <img src="img/bismillah.png" alt="bismillah" class="bismillah-img reveal-scale d-2">
                <p class="reveal-text d-1">"Dan di antara tanda-tanda (kebesaran)-Nya ialah Dia menciptakan pasangan-pasangan untukmu dari jenismu sendiri, agar kamu cenderung dan merasa tenteram kepadanya, dan Dia menjadikan di antaramu rasa kasih dan sayang. Sungguh, pada yang demikian itu benar-benar terdapat tanda-tanda (kebesaran Allah) bagi kaum yang berpikir."</p>
                <h2 class="reveal-text d-3">QS Ar-Rum Ayat 21</h2>
            </div>
        </section>

       <section id="slide3" class="content-slide hidden-slide">
            <div class="clouds">
                <div class="cloud c1"></div>
                <div class="cloud c2"></div>
                <div class="cloud c3"></div>
            </div>
            <div class="couple-wrapper reveal-box d-0">

                <div class="text-section">
                    <h2 class="reveal-text d-1">اَلسَّلَامُ عَلَيْكُمْ وَرَحْمَةُ اَللهِ وَبَرَكَاتُهُ.</h2>
                    <p class="reveal-text d-2">Dengan berkah dan rahmat Allah SWT. Dengan hormat kami mengundang Bapak/Ibu/Saudara/i ke acara pernikahan kami</p>
                </div>
                <div class="couple-card">
                    <div class="flower-top-right"></div> <div class="flower-bottom-left"></div> <div class="photo-frame">
                        <img src="img/gambar2.png" alt="Winda">
                    </div>
                    <h3 class="couple-name">Winda Amelia</h3>
                    <p>Putri dari <br>Bapak. Nurdin & Ibu. Rohmat</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/windaamlll_" target="_blank" class="instagram-btn">
                            <i class="fab fa-instagram"></i>
                            <span>windaamlll_</span>
                        </a>
                    </div>
                </div>
                <div class="couple-card">
                    <div class="flower-top-right"></div>
                    <div class="flower-bottom-left"></div>
                    <div class="photo-frame">
                        <img src="img/gambar1.png" alt="Wisnu">
                    </div>
                    <h3 class="couple-name">Wisnu Hendrawan</h3>
                    <p>Putra dari <br>Bapak. Ahmad Ujib & Ibu. Ida Widaningsih</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/wisnuu.h" target="_blank" class="instagram-btn">
                            <i class="fab fa-instagram"></i>
                            <span>wisnuu.h</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <section id="slide4" class="content-slide hidden-slide">
            <h2 class="reveal-text d-0">Akad & Resepsi</h2>
            <div class="couple-wrapper reveal-box d-1">
                <div class="event-details">
                    <p class="reveal-text d-3">Jum'at, 09 Januari 2026</p>
                    <p class="reveal-text d-4">08.00 - Selesai</p>
                     <h3 class="reveal-text d-2">Rumah Kediaman Mempelai</h3>
                </div>
                <div class="address-section">
                    <img src="img/barcode.png" alt="Barcode Alamat" class="barcode-img reveal-scale d-5">
                    <h3 class="reveal-text d-2">Kp. Cikonju Rt 016/ Rw 007 Desa. Kutapohaci Kec. Ciampel, Kab. Karawang</h3>
                    <a href="https://maps.app.goo.gl/QqE5PfGLfcGRxafq6" target="_blank" class="btn-buka reveal-box d-6">Buka Google Maps</a>
                </div>
            </div>
        </section>

        <section id="slide5" class="content-slide hidden-slide">
            <h2 class="reveal-text d-0">Menuju Hari Bahagia</h2>
            <div class="couple-wrapper reveal-box d-1">
                <div class="countdown-wrapper">
            <div class="time-box reveal-scale d-2">
                <span id="days">00</span>
                <small>Hari</small>
            </div>
            <div class="time-box reveal-scale d-3">
                <span id="hours">00</span>
                <small>Jam</small>
            </div>
            <div class="time-box reveal-scale d-4">
                <span id="minutes">00</span>
                <small>Menit</small>
            </div>
            <div class="time-box reveal-scale d-5">
                <span id="seconds">00</span>
                <small>Detik</small>
            </div>
                </div>
            </div>
            <div class="couple-wrapper">
                <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=Pernikahan+Winda+%26+Wisnu&dates=20260109T080000/20260109T120000&details=Akad+%26+Resepsi+Pernikahan+Winda+dan+Wisnu&location=Kp.+Cikonju+Rt+016/+Rw+007+Desa.+Kutapohaci+Kec.+Ciampel,+Kab.+Karawang" target="_blank" class="btn-buka reveal-box d-6" style="font-size: 0.7em;"><i class="fas fa-calendar-plus"></i> Tambah ke Kalender</a>
            </div>
        </section>

        <section id="slide6" class="content-slide hidden-slide">
            <h2 class="reveal-text d-0">Galeri Foto</h2>
            <div class="gallery-grid">
                <div class="gallery-item">
                    <img src="img/1.jpg" alt="Foto Winda & Wisnu 1">
                </div>
                <div class="gallery-item">
                    <img src="img/2.jpg" alt="Foto Winda & Wisnu 2">
                </div>
                <div class="gallery-item">
                    <img src="img/3.jpeg" alt="Foto Winda & Wisnu 3">
                </div>
                <div class="gallery-item">
                    <img src="img/4.jpg" alt="Foto Winda & Wisnu 4">
                </div>
                <div class="gallery-item">
                    <img src="img/5.jpg" alt="Foto Winda & Wisnu 5">
                </div>
                <div class="gallery-item">
                    <img src="img/6.JPEG" alt="Foto Winda & Wisnu 6">
                </div>
            </div>
        </section>
        
        <section id="slide7" class="content-slide">
            <div class="clouds">
                <div class="cloud c1"></div>
                <div class="cloud c2"></div>
                <div class="cloud c3"></div>
            </div>
            <h2 class="reveal-text d-0">Konfirmasi Kehadiran (RSVP)</h2>
            <div class="couple-wrapper reveal-box d-1">
                <p>Mohon konfirmasi kehadiran Anda sebelum tanggal 01 Januari 2026.</p>

                <form class="rsvp-form glass-card" id="rsvp-form">
                    <input type="text" name="nama" placeholder="Nama Anda" id="rsvp-name" required>
                    <select name="status" required id="rsvp-status">
                        <option value="">Pilih Kehadiran</option>
                        <option value="Hadir">Akan Hadir</option>
                        <option value="Tidak">Tidak Dapat Hadir</option>
                    </select>
                    <input type="number" name="jumlah" placeholder="Jumlah Orang" required min="1" value="1" id="rsvp-count">
                    <input type="hidden" name="formType" value="rsvp"> <button type="submit" class="btn-buka" id="btn-submit">Kirim Konfirmasi</button>

                    <div id="rsvp-loading" style="display:none; margin-top: 10px;">
                        <i class="fas fa-spinner fa-spin"></i> Mengirim data...
                    </div>
                    <p id="rsvp-message" style="margin-top: 10px; font-weight: 600;"></p>
                </form>
            </div>
        </section>

        <section id="slide8" class="content-slide hidden-slide">
            <div class="clouds">
                <div class="cloud c1"></div>
                <div class="cloud c2"></div>
                <div class="cloud c3"></div>
            </div>
            <h2 class="reveal-text d-0">Kirim Ucapan & Doa</h2>
            <div class="couple-wrapper reveal-box d-1">
                <p>Do'a dan ucapan dari Anda adalah kado terindah.</p>

                <form class="rsvp-form glass-card" id="greeting-form">
                    <input type="text" name="nama" placeholder="Nama Anda" required>
                    <textarea name="ucapan" placeholder="Tuliskan Ucapan dan Doa Terbaik Anda..." rows="4" required></textarea>
                    <input type="hidden" name="formType" value="greeting"> <button type="submit" class="btn-buka" id="btn-submit-greeting">Kirim Ucapan</button>

                    <div id="greeting-loading" style="display:none; margin-top: 10px;">
                        <i class="fas fa-spinner fa-spin"></i> Mengirim data...
                    </div>
                    <p id="greeting-message" style="margin-top: 10px; font-weight: 600;"></p>
                </form>

                <!-- Live Chat Section -->
                <div class="chat-container glass-card">
                    <h3>Live Chat Ucapan & Doa</h3>
                    <div id="chat-messages" class="chat-messages"></div>
                    <div id="chat-loading" style="display:none; text-align: center; margin: 10px 0;">
                        <i class="fas fa-spinner fa-spin"></i> Memuat pesan...
                    </div>
                </div>
            </div>
        </section>

        <section id="slide9" class="content-slide hidden-slide">
            <div class="clouds">
                <div class="cloud c1"></div>
                <div class="cloud c2"></div>
                <div class="cloud c3"></div>
            </div>
            <h2 class="reveal-text d-0">Hadiah Terbaik</h2>
            <div class="couple-wrapper reveal-box d-1">
                <h3>Do'a restu dari Anda adalah kado terindah. Namun, jika Anda ingin memberikan hadiah, silakan gunakan informasi di bawah ini:</h3>

                <div class="atm-card">
                    <img src="img/bca.png" alt="BCA" class="atm-logo">
                    <div>
                        <p class="account-name">Winda Amelia</p>
                        <p id="rekening1">6785318840</p>
                    </div>
                    <button class="btn-copy" onclick="copyToClipboard('rekening1')">Salin</button>
                </div>

                <div class="atm-card">
                    <img src="img/mandiri.png" alt="Mandiri" class="atm-logo">
                    <div>
                        <p class="account-name">Wisnu Hendrawan</p>
                        <p id="rekening2">1300027108722</p>
                    </div>
                    <button class="btn-copy" onclick="copyToClipboard('rekening2')">Salin</button>
                </div>

                <h3 class="catatan">Atas perhatian dan do'anya, kami ucapkan terima kasih.</h3>
            </div>
        </section>

        <section id="slide10" class="content-slide hidden-slide">
            <div class="clouds">
                <div class="cloud c1"></div>
                <div class="cloud c2"></div>
                <div class="cloud c3"></div>
            </div>
            <div class="couple-wrapper reveal-box d-0">
                <p>Kami yang berbahagia</p>
                <h1>Winda & Wisnu</h1>
                <p>Wassalamu'alaikum Warahmatullahi Wabarakatuh</p>
            </div>
        </section>

    </div>

    <!-- Guest Name Modal -->
    <div id="guest-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Selamat Datang!</h2>
            <p id="modal-guest-name"></p>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="gallery-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <img id="modal-image" src="" alt="">
            <p id="modal-caption" style="margin-top:8px; color:var(--secondary-color);"></p>
        </div>
    </div>

    <div id="butterfly1" class="butterfly-effect"></div>
    <div id="butterfly2" class="butterfly-effect"></div>
    <div id="butterfly3" class="butterfly-effect"></div>
    <div id="butterfly4" class="butterfly-effect"></div>
    <div id="butterfly5" class="butterfly-effect"></div>
    <div id="butterfly6" class="butterfly-effect"></div>
    <div id="butterfly7" class="butterfly-effect"></div>
    <div id="butterfly8" class="butterfly-effect"></div>
    <div id="butterfly9" class="butterfly-effect"></div>
    <div id="butterfly10" class="butterfly-effect"></div>

    <!-- Bottom Navigation Menu -->
    <nav class="bottom-nav">
        <a href="#slide1" class="nav-item">
            <i class="fas fa-home"></i>
        </a>
        <a href="#slide2" class="nav-item">
            <i class="fas fa-book"></i>
        </a>
        <a href="#slide3" class="nav-item">
            <i class="fas fa-heart"></i>
        </a>
        <a href="#slide4" class="nav-item">
            <i class="fas fa-calendar-alt"></i>
        </a>
        <a href="#slide5" class="nav-item">
            <i class="fas fa-clock"></i>
        </a>
        <a href="#slide6" class="nav-item">
            <i class="fas fa-images"></i>
        </a>
        <a href="#slide7" class="nav-item">
            <i class="fas fa-envelope"></i>
        </a>
    </nav>

    <!-- Music Control Button -->
    <div class="music-control" style="display: none;">
        <div id="record-logo" class="record-logo">
            <i class="fas fa-play"></i>
        </div>
    </div>

    <!-- Floating Hearts Background Effects -->
    <div class="floating-heart" style="left: 10%; animation-delay: 0s;"></div>
    <div class="floating-heart" style="left: 20%; animation-delay: 2s;"></div>
    <div class="floating-heart" style="left: 30%; animation-delay: 4s;"></div>
    <div class="floating-heart" style="left: 40%; animation-delay: 6s;"></div>
    <div class="floating-heart" style="left: 50%; animation-delay: 8s;"></div>
    <div class="floating-heart" style="left: 60%; animation-delay: 10s;"></div>
    <div class="floating-heart" style="left: 70%; animation-delay: 12s;"></div>
    <div class="floating-heart" style="left: 80%; animation-delay: 14s;"></div>
    <div class="floating-heart" style="left: 90%; animation-delay: 16s;"></div>

    <script>
        // --- KONFIGURASI PENTING ---
        // GANTI DENGAN URL WEB APP GOOGLE APPS SCRIPT ANDA
        // Ikuti instruksi di SETUP_GOOGLE_SHEETS.md untuk mendapatkan URL ini
        // Contoh URL: https://script.google.com/macros/s/AKfycbx...xyz/usercontent
        const scriptURL = 'https://script.google.com/macros/s/AKfycbztqyC86UQGM4gQWvFnOK2A2e9joxD-ZZ2F19fd-OTmHv4Ivu9Js4QGXgfbNmrKdPfGfA/exec'; // GANTI INI DENGAN URL APPS SCRIPT ANDA

        // 1. TAMPILKAN NAMA TAMU DARI URL DAN UBAH WARNA
        const params = new URLSearchParams(window.location.search);
        const guestName = params.get('nama') || params.get('to'); // Support both ?nama= and ?to=
        const guestNameContainer = document.getElementById('guest-name');
        const rsvpNameInput = document.getElementById('rsvp-name');

        if (guestName) {
            const cleanName = decodeURIComponent(guestName);
            guestNameContainer.innerText = cleanName;

            // --- MODIFIKASI WARNA OTOMATIS ---
            guestNameContainer.classList.add('guest-name-dynamic'); // Menggunakan CSS class
            // --- AKHIR MODIFIKASI WARNA ---

            rsvpNameInput.value = cleanName; // Otomatis isi nama di form RSVP

            // Show guest name modal
            const modal = document.getElementById('guest-modal');
            const modalGuestName = document.getElementById('modal-guest-name');
            modalGuestName.innerText = cleanName;
            modal.style.display = 'block';

            // Close modal on click (close button only here)
            const closeBtn = document.querySelector('.close-modal');
            closeBtn.onclick = function() {
                modal.style.display = 'none';
            };

            // Record guest visit to Google Sheet
            recordGuestVisit(cleanName);
        } else {
            guestNameContainer.innerText = "Tamu Undangan";
        }

        // FUNGSI: Catat kunjungan tamu ke Google Sheet
        function recordGuestVisit(guestName) {
            const url = scriptURL + '?nama=' + encodeURIComponent(guestName);
            fetch(url, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                Logger.log('Guest visit recorded:', data);
            })
            .catch(error => {
                console.error('Error recording guest visit:', error);
            });
        }

        // 2. ANIMASI SCROLL
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('active');
                    if (entry.target.id === 'slide1') {
                        document.querySelector('.bottom-nav').style.display = 'none';
                    }
                } else {
                    entry.target.classList.remove('active');
                    if (entry.target.id === 'slide1') {
                        document.querySelector('.bottom-nav').style.display = 'flex';
                    }
                }
            });
        }, { threshold: 0 });

        // Auto scroll on button click, hide slide1, and enable scrolling
        document.querySelector('.btn-buka').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('slide1').style.display = 'none';
            document.getElementById('scrollContainer').style.overflowY = 'scroll';
            document.getElementById('slide2').scrollIntoView({ behavior: 'smooth' });

            // Show music control button
            document.querySelector('.music-control').style.display = 'flex';

            // Auto-play music
            backgroundMusic.play();
            backgroundMusic.muted = false;
            recordLogo.innerHTML = '<i class="fas fa-pause"></i>';
            recordLogo.classList.add('spinning');
            isPlaying = true;
        });

        document.querySelectorAll('section').forEach(section => {
            observer.observe(section);
        });

        // 3. LOGIC COUNTDOWN
        const weddingDate = new Date("Jan 09, 2026 08:00:00").getTime();
        const timer = setInterval(() => {
            const now = new Date().getTime();
            const distance = weddingDate - now;

            if (distance < 0) {
                clearInterval(timer);
                return;
            }
            document.getElementById("days").innerText = Math.floor(distance / (1000 * 60 * 60 * 24)).toString().padStart(2, '0');
            document.getElementById("hours").innerText = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0');
            document.getElementById("minutes").innerText = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0');
            document.getElementById("seconds").innerText = Math.floor((distance % (1000 * 60)) / 1000).toString().padStart(2, '0');
        }, 1000);

        // 4. COPY REKENING
        function copyToClipboard(id) {
            const text = document.getElementById(id).innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("Nomor rekening berhasil disalin!");
            });
        }

        // 5. KIRIM RSVP KE GOOGLE SHEETS
        const formRSVP = document.forms['rsvp-form'];
        const btnSubmitRSVP = document.getElementById('btn-submit');
        const loadingRSVP = document.getElementById('rsvp-loading');
        const messageRSVP = document.getElementById('rsvp-message');

        formRSVP.addEventListener('submit', e => {
            e.preventDefault();

            if (scriptURL === '') {
                alert("Error: URL Google Apps Script belum dipasang dengan benar di kode HTML.");
                return;
            }

            btnSubmitRSVP.style.display = 'none';
            loadingRSVP.style.display = 'block';
            messageRSVP.innerText = '';

            // Kirim Data, Apps Script akan memproses berdasarkan formType=rsvp
            fetch(scriptURL + '?' + new URLSearchParams(new FormData(formRSVP)).toString())
                .then(response => {
                    loadingRSVP.style.display = 'none';
                    btnSubmitRSVP.style.display = 'block';
                    messageRSVP.style.color = 'green';
                    messageRSVP.innerText = "Terima kasih! Konfirmasi kehadiran Anda telah tersimpan.";
                    formRSVP.reset();
                    if(guestName) rsvpNameInput.value = decodeURIComponent(guestName);
                })
                .catch(error => {
                    loadingRSVP.style.display = 'none';
                    btnSubmitRSVP.style.display = 'block';
                    messageRSVP.style.color = 'red';
                    messageRSVP.innerText = "Gagal mengirim pesan! Coba lagi.";
                    console.error('Error!', error.message);
                });
        });
        
        // 6. KIRIM UCAPAN KE GOOGLE SHEETS
        const formGreeting = document.forms['greeting-form'];
        const btnSubmitGreeting = document.getElementById('btn-submit-greeting');
        const loadingGreeting = document.getElementById('greeting-loading');
        const messageGreeting = document.getElementById('greeting-message');

        formGreeting.addEventListener('submit', e => {
            e.preventDefault();

            if (scriptURL === '') {
                alert("Error: URL Google Apps Script belum dipasang dengan benar di kode HTML.");
                return;
            }

            btnSubmitGreeting.style.display = 'none';
            loadingGreeting.style.display = 'block';
            messageGreeting.innerText = '';

            // Kirim Data, Apps Script akan memproses berdasarkan formType=greeting
            fetch(scriptURL + '?' + new URLSearchParams(new FormData(formGreeting)).toString())
                .then(response => {
                    loadingGreeting.style.display = 'none';
                    btnSubmitGreeting.style.display = 'block';
                    messageGreeting.style.color = 'green';
                    messageGreeting.innerText = "Terima kasih! Ucapan Anda telah terkirim.";
                    formGreeting.reset();
                })
                .catch(error => {
                    loadingGreeting.style.display = 'none';
                    btnSubmitGreeting.style.display = 'block';
                    messageGreeting.style.color = 'red';
                    messageGreeting.innerText = "Gagal mengirim ucapan! Coba lagi.";
                    console.error('Error!', error.message);
                });
        });

        // 7. GALLERY MODAL FUNCTIONALITY
        const galleryItems = document.querySelectorAll('.gallery-item');

        galleryItems.forEach(item => {
            item.addEventListener('click', () => {
                const modal = document.getElementById('gallery-modal');
                const modalImg = document.getElementById('modal-image');
                const modalCaption = document.getElementById('modal-caption');
                modalImg.src = item.querySelector('img').src;
                modalCaption.innerText = item.getAttribute('data-caption');
                modal.style.display = 'block';
            });
        });

        // Close modal: buttons
        const closeBtns = document.querySelectorAll('.close-modal');
        closeBtns.forEach(btn => {
            btn.onclick = function() {
                const modal = btn.closest('.modal');
                modal.style.display = 'none';
            };
        });

        // Global click handler to close modal when clicking on modal overlay
        document.addEventListener('click', function(event) {
            // If clicked element is the modal overlay itself (not modal-content), close it
            if (event.target && event.target.classList && event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });

        // 8. MUSIC CONTROL FUNCTIONALITY
        const recordLogo = document.getElementById('record-logo');
        const backgroundMusic = document.getElementById('background-music');

        let isPlaying = false;

        recordLogo.addEventListener('click', () => {
            if (isPlaying) {
                backgroundMusic.pause();
                recordLogo.innerHTML = '<i class="fas fa-play"></i>';
                recordLogo.classList.remove('spinning');
            } else {
                backgroundMusic.play();
                backgroundMusic.muted = false; // Unmute on first play
                recordLogo.innerHTML = '<i class="fas fa-pause"></i>';
                recordLogo.classList.add('spinning');
            }
            isPlaying = !isPlaying;
        });

        // 9. LIVE CHAT FUNCTIONALITY
        const chatMessages = document.getElementById('chat-messages');
        const chatLoading = document.getElementById('chat-loading');

        function fetchMessages() {
            chatLoading.style.display = 'block';
            fetch(scriptURL + '?action=getGreetings')
                .then(response => response.json())
                .then(data => {
                    chatLoading.style.display = 'none';
                    chatMessages.innerHTML = '';
                    if (data && data.length > 0) {
                        data.forEach(msg => {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = 'chat-message';
                            messageDiv.innerHTML = `<strong>${msg.nama}</strong><br>${msg.ucapan}<br><small>${new Date(msg.timestamp).toLocaleString()}</small>`;
                            chatMessages.appendChild(messageDiv);
                        });
                        chatMessages.scrollTop = chatMessages.scrollHeight; // Auto scroll to bottom
                    } else {
                        chatMessages.innerHTML = '<p style="text-align: center; color: var(--secondary-color);">Belum ada ucapan. Jadilah yang pertama!</p>';
                    }
                })
                .catch(error => {
                    chatLoading.style.display = 'none';
                    console.error('Error fetching messages:', error);
                    chatMessages.innerHTML = '<p style="text-align: center; color: red;">Gagal memuat pesan. Coba lagi nanti.</p>';
                });
        }

        // Fetch messages on page load and poll every 10 seconds
        fetchMessages();
        setInterval(fetchMessages, 10000);

        // LOADING SCREEN HANDLER
        // Use a class toggle so mobile browsers don't suffer layout jumps caused
        // by immediate display:none or fixed 100vh calculations.
        window.addEventListener('load', function() {
            const loadingScreen = document.getElementById('loading-screen');

            // Give a small minimum time for the loader to be visible (optional)
            const minVisibleMs = 800; // reduce from 3000 to avoid long waits on mobile

            // When load fires, add the hidden class to animate fade out,
            // then remove the element from flow after the transition ends.
            setTimeout(() => {
                loadingScreen.classList.add('loading-hidden');

                // after transition, fully remove from layout to avoid any capture of clicks
                setTimeout(() => {
                    try { loadingScreen.style.display = 'none'; } catch(e) {}
                }, 500);

                // Show butterflies after loading screen finishes
                document.querySelectorAll('.butterfly-effect').forEach(butterfly => {
                    butterfly.style.display = 'block';
                });
            }, minVisibleMs);
        });

    </script>
</body>
</html>